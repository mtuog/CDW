<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat Widget Behavior</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.logged-in {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.logged-out {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Chat Widget Behavior</h1>
        
        <div class="test-section">
            <h3>üìä Current Status</h3>
            <div id="status" class="status"></div>
            <div>
                <strong>Current URL:</strong> <span id="currentUrl"></span>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîê Authentication Simulation</h3>
            <button onclick="simulateLogin()">Simulate Login</button>
            <button onclick="simulateLogout()">Simulate Logout</button>
            <button onclick="checkCurrentAuth()">Check Auth Status</button>
        </div>
        
        <div class="test-section">
            <h3>üß≠ Navigation Simulation</h3>
            <button onclick="simulateNavigation('/home')">Go to Home</button>
            <button onclick="simulateNavigation('/login')">Go to Login</button>
            <button onclick="simulateNavigation('/register')">Go to Register</button>
            <button onclick="simulateNavigation('/admin/dashboard')">Go to Admin</button>
        </div>
        
        <div class="test-section">
            <h3>üìù Expected Behavior</h3>
            <ul>
                <li>‚úÖ <strong>Chat widget xu·∫•t hi·ªán ·ªü t·∫•t c·∫£ trang</strong> (tr·ª´ login/register/admin)</li>
                <li>‚úÖ <strong>Khi ch∆∞a login:</strong> Widget m√†u cam v·ªõi d·∫•u "!" ‚Üí click v√†o h·ªèi login</li>
                <li>‚úÖ <strong>Khi ƒë√£ login:</strong> Widget m√†u xanh ‚Üí click v√†o m·ªü chat</li>
                <li>‚úÖ <strong>Logout:</strong> Widget ƒë·ªïi sang m√†u cam, connection b·ªã ƒë√≥ng</li>
                <li>‚ùå <strong>Trang login/register:</strong> Widget ho√†n to√†n bi·∫øn m·∫•t</li>
            </ul>
        </div>
    </div>

    <script>
        function updateStatus() {
            const token = localStorage.getItem('token');
            const userId = localStorage.getItem('userId');
            const isLoggedIn = !!(token && userId);
            
            const statusEl = document.getElementById('status');
            const currentUrlEl = document.getElementById('currentUrl');
            
            if (isLoggedIn) {
                statusEl.className = 'status logged-in';
                statusEl.innerHTML = `
                    ‚úÖ <strong>Logged In</strong><br>
                    User ID: ${userId}<br>
                    Token: ${token.substring(0, 20)}...
                `;
            } else {
                statusEl.className = 'status logged-out';
                statusEl.innerHTML = '‚ùå <strong>Not Logged In</strong>';
            }
            
            currentUrlEl.textContent = window.location.pathname;
        }
        
        function simulateLogin() {
            // Simulate login with fake data
            localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.fake_token_' + Date.now());
            localStorage.setItem('userId', '123');
            localStorage.setItem('userName', 'Test User');
            
            // Trigger auth change event
            window.dispatchEvent(new Event('auth-change'));
            
            updateStatus();
            alert('‚úÖ Simulated login successful!');
        }
        
        function simulateLogout() {
            // Clear auth data
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            localStorage.removeItem('userName');
            
            // Trigger auth change event
            window.dispatchEvent(new Event('auth-change'));
            
            updateStatus();
            alert('üîì Simulated logout successful!');
        }
        
        function checkCurrentAuth() {
            updateStatus();
        }
        
        function simulateNavigation(path) {
            // This just shows what would happen, doesn't actually navigate
            alert(`üß≠ Simulating navigation to: ${path}\n\nChat widget should ${shouldShowWidget(path) ? 'SHOW' : 'HIDE'} on this page.`);
        }
        
        function shouldShowWidget(path) {
            const excludedPaths = ['/login', '/register', '/forgot-password', '/reset-password', '/verify-account'];
            return !excludedPaths.includes(path) && !path.startsWith('/admin/');
        }
        
        // Initialize
        updateStatus();
        
        // Listen for auth changes
        window.addEventListener('auth-change', updateStatus);
        
        // Auto-refresh status every 2 seconds
        setInterval(updateStatus, 2000);
    </script>
</body>
</html> 